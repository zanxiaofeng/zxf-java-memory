

以下是 JDK 17 中控制 Java 进程内存的主要参数及其说明的列表形式：

---

### **JDK 17 内存控制参数列表**

#### **1. 堆内存**
- **`-Xms<size>`**
    - **默认值**：系统内存的 1/64（如 1GB 内存系统约为 16MB）
    - **说明**：设置初始堆大小（例如 `-Xms512m`）。
    - **注意**：建议与 `-Xmx` 设置为相同值，避免运行时堆动态扩展的开销。

- **`-Xmx<size>`**
    - **默认值**：系统内存的 1/4（如 8GB 内存系统约为 2GB）
    - **说明**：设置最大堆大小（例如 `-Xmx4g`）。
    - **注意**：超过物理内存可能导致 `OutOfMemoryError`。

- **`-XX:NewRatio=<n>`**
    - **默认值**：2（老年代:新生代 = 2:1）
    - **说明**：老年代与新生代的内存比例（仅对分代式 GC 有效）。
    - **注意**：若设置 `-Xmn`，此参数无效。

- **`-Xmn<size>`**
    - **默认值**：无
    - **说明**：直接设置新生代大小（例如 `-Xmn256m`）。
    - **注意**：需权衡新生代和老年代的空间分配。

- **`-XX:SurvivorRatio=<n>`**
    - **默认值**：8（Eden:Survivor = 8:1:1）
    - **说明**：设置 Eden 区与 Survivor 区的比例（例如 `-XX:SurvivorRatio=6`）。
    - **注意**：仅对分代式 GC（如 G1、Serial）有效。

---

#### **2. 元空间（方法区）**
- **`-XX:MetaspaceSize=<size>`**
    - **默认值**：约 20.8MB
    - **说明**：元空间初始大小（触发 GC 的阈值）。
    - **注意**：实际占用可能超过此值，但会触发 GC。

- **`-XX:MaxMetaspaceSize=<size>`**
    - **默认值**：无限制（受限于系统内存）
    - **说明**：设置元空间最大大小（例如 `-XX:MaxMetaspaceSize=256m`）。
    - **注意**：未设置时可能耗尽系统内存。

---

#### **3. 线程栈**
- **`-Xss<size>`**
    - **默认值**：1MB（Linux）
    - **说明**：设置单个线程的栈大小（例如 `-Xss256k`）。
    - **注意**：栈过小导致 `StackOverflowError`，过大会限制总线程数。

---

#### **4. 直接内存**
- **`-XX:MaxDirectMemorySize=<size>`**
    - **默认值**：与 `-Xmx` 相同
    - **说明**：设置直接内存（Direct Buffer）的最大大小（例如 `-XX:MaxDirectMemorySize=1g`）。
    - **注意**：未显式设置时，实际限制为 `-Xmx` 的值。

---

#### **5. 压缩指针**
- **`-XX:+UseCompressedOops`**
    - **默认值**：启用
    - **说明**：启用压缩指针（32 位指针寻址 64 位堆，节省内存）。
    - **注意**：堆大小 ≤32GB 时有效，禁用需显式设置 `-XX:-UseCompressedOops`。

---

#### **6. 垃圾回收器**
- **`-XX:+UseG1GC`**
    - **默认值**：JDK 9+ 默认启用
    - **说明**：启用 G1 垃圾回收器。
    - **注意**：JDK 17 默认 GC。

- **`-XX:+UseZGC`**
    - **默认值**：需显式启用
    - **说明**：启用 ZGC（低延迟 GC，适合大堆）。
    - **注意**：需堆大小 ≥2GB 时效果显著。

- **`-XX:+UseShenandoahGC`**
    - **默认值**：需显式启用
    - **说明**：启用 Shenandoah（并发压缩 GC）。
    - **注意**：需 JDK 12+，Red Hat 贡献。

---

#### **7. 其他内存参数**
- **`-XX:ReservedCodeCacheSize=<size>`**
    - **默认值**：240MB
    - **说明**：设置 JIT 编译代码缓存区大小（例如 `-XX:ReservedCodeCacheSize=512m`）。
    - **注意**：缓存满会导致 JIT 停止编译。

- **`-XX:MaxRAMPercentage=<n>`**
    - **默认值**：25（容器环境）
    - **说明**：设置 JVM 最大内存占容器总内存的百分比（例如 `-XX:MaxRAMPercentage=75`）。
    - **注意**：适用于容器化部署（替代 `-Xmx`）。

- **`-XX:InitialRAMPercentage=<n>`**
    - **默认值**：1.5625（容器环境）
    - **说明**：设置 JVM 初始内存占容器总内存的百分比（例如 `-XX:InitialRAMPercentage=50`）。
    - **注意**：需与 `-XX:MaxRAMPercentage` 配合使用。

---

### **关键注意事项**
1. **堆外内存**：直接内存、线程栈、元空间等不受 `-Xmx` 限制，需单独配置。
2. **容器部署**：优先使用 `-XX:MaxRAMPercentage` 动态适配内存限制。
3. **监控工具**：
    - `jcmd <pid> VM.native_memory`：查看 Native 内存分布。
    - `jstat -gc <pid>`：监控堆内存和 GC 行为。
